#! /bin/bash --login
#SBATCH -p himem 
#SBATCH -t 2-0
#SBATCH -n 4

#SBATCH --mail-user=michael.haley@manchester.ac.uk
#SBATCH --mail-type=ALL

#@DESC: Extracts TIFFs from MCD files and sets up metadata folders, including panel file
#@IN:   /MCD_files/
#@OUT:  /tiffs, /tiff_stacks, /metadata, /metadata/dictionary.csv, /metadata/panel.csv

echo "Preprocessing job is using $SLURM_GPUS GPU(s) with ID(s) $CUDA_VISIBLE_DEVICES and $SLURM_NTASKS CPU core(s)"

module load gcc/13.3.0
export MPLBACKEND="Agg"
export QT_QPA_PLATFORM="offscreen"
unset DISPLAY

conda activate segmentation
python -m SpatialBiologyToolkit.scripts.preprocess